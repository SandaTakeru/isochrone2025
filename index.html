<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- GitHub Pages ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡ -->
  <meta http-equiv="Cache-Control" content="public, max-age=3600">
  <title>åˆ°é”åœãƒãƒƒãƒ— (Rail Isochrone)</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link href="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.js"></script>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <!-- ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç‰ˆï¼‰ -->
  <div id="titleBar">
    <button id="menuToggleBtn" class="menuToggleBtn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
      <span class="hamburger">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </span>
    </button>
    <div class="mobileTitleContainer">
      <h1 id="mobileTitle">é‰„é“åˆ°é”åœãƒãƒƒãƒ—</h1>
      <span class="betaBadgeMobile">BETA</span>
    </div>
    <div id="mobileLastUpdate" class="mobileLastUpdated"></div>
  </div>

  <div id="controls">
    <div id="controlsHeader">
      <div style="display: flex; align-items: center; gap: 8px;">
        <h1>é‰„é“åˆ°é”åœãƒãƒƒãƒ—</h1>
        <span class="betaBadge">BETA</span>
      </div>
      <p class="headerDescription">æ™‚é–“å†…ã«åˆ°é”å¯èƒ½ãªã‚¨ãƒªã‚¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚åœ°å›³ä¸Šã§å‡ºç™ºåœ°ç‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚é€Ÿåº¦æ¡ä»¶ãªã©ã€è©³ã—ãã¯ã“ã¡ã‚‰ã€‚</p>
      <p class="lastUpdated">æœ€çµ‚æ›´æ–°: <span id="lastUpdateDate"></span></p>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: ä½ç½®æ¤œç´¢ -->
    <div class="controlSection">
      <div class="sectionLabel">ğŸ™ï¸ éƒ½å¸‚é¸æŠ</div>
      <select id="citySelect" class="selectControl">
        <option value="">-- éƒ½å¸‚ã‚’é¸æŠ --</option>
        <option value="sapporo">æœ­å¹Œå¸‚</option>
        <option value="sendai">ä»™å°å¸‚</option>
        <option value="tokyo">æ±äº¬éƒ½</option>
        <option value="yokohama">æ¨ªæµœå¸‚</option>
        <option value="nagoya">åå¤å±‹å¸‚</option>
        <option value="osaka">å¤§é˜ªå¸‚</option>
        <option value="kobe">ç¥æˆ¸å¸‚</option>
        <option value="kyoto">äº¬éƒ½å¸‚</option>
        <option value="fukuoka">ç¦å²¡å¸‚</option>
      </select>
    </div>

    <div class="controlSection">
      <div class="sectionLabel">ğŸ” ä½æ‰€æ¤œç´¢</div>
      <div class="addressSearchContainer">
        <input type="text" id="addressInput" class="addressInput" placeholder="ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" aria-label="ä½æ‰€å…¥åŠ›æ¬„">
        <button id="addressSearchBtn" class="addressSearchBtn" aria-label="æ¤œç´¢">ğŸ”ä½æ‰€æ¤œç´¢</button>
      </div>
      <div id="addressSearchResults" class="addressSearchResults" style="display: none;"></div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: è§£ææ™‚é–“è¨­å®š -->
    <div class="controlSection">
      <div class="sectionLabel">â±ï¸ åˆ°é”æ™‚é–“ï¼ˆæœ€å¤§12æ™‚é–“ï¼‰</div>
      <div class="timeInputContainer">
        <div class="timeDisplayRow">
          <span id="timeDisplay" class="timeDisplayEditable" contenteditable="true">1æ™‚é–“</span>
        </div>

        <input type="range" id="timeSlider" class="timeSlider" min="1" max="144" value="12" step="1">
      </div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="controlSection">
      <div class="sectionLabel">âš™ï¸ åˆ°é”åœã®è¨­å®š</div>
      <div class="buttonGroup">
        <button id="resetBtn" class="primaryBtn">åˆ°é”åœã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        <button id="lockBtn" class="secondaryBtn" style="display: none;">åˆ°é”åœã‚’å›ºå®š</button>
        <button id="unlockBtn" class="warningBtn" style="display: none;">å›ºå®šã‚’è§£é™¤</button>
      </div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³4: åˆ°é”é§…ä¸€è¦§ -->
    <div id="stationTable" class="controlSection" style="display: none;">
      <div class="sectionLabel">ğŸš‰ åˆ°é”é§…ä¸€è¦§ï¼ˆ<span id="totalCount">0</span>ä»¶ï¼‰</div>
      <div id="tableContainer" class="tableContainer">
        <table class="stationTable">
          <thead>
            <tr id="tableHeaderRow">
              <th id="headerStation" class="tableHeader">é§…å</th>
              <th id="headerTime" class="tableHeader">åˆ°é”æ™‚é–“</th>
              <th id="headerCompany" class="tableHeader">é‹å–¶ä¼šç¤¾</th>
              <th id="headerLine" class="tableHeader">è·¯ç·šå</th>
            </tr>
          </thead>
          <tbody id="stationTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³5: å‡¡ä¾‹ -->
    <div class="controlSection">
      <div class="sectionLabel">ğŸš† é‰„é“è·¯ç·šå‡¡ä¾‹</div>
      <div class="legendContainer">
        <div class="legendItem">
          <span class="legendColor" style="background: rgb(255, 0, 0);"></span>
          <span>æ–°å¹¹ç·šï¼ˆJRï¼‰</span>
        </div>
        <div class="legendItem">
          <span class="legendColor" style="background: rgb(0, 170, 0);"></span>
          <span>åœ¨æ¥ç·šï¼ˆJRï¼‰</span>
        </div>
        <div class="legendItem">
          <span class="legendColor" style="background: rgb(0, 0, 255);"></span>
          <span>å…¬å–¶é‰„é“</span>
        </div>
        <div class="legendItem">
          <span class="legendColor" style="background: rgb(255, 153, 0);"></span>
          <span>æ°‘å–¶é‰„é“</span>
        </div>
        <div class="legendItem">
          <span class="legendColor" style="background: rgb(153, 0, 255);"></span>
          <span>ç¬¬ä¸‰ã‚»ã‚¯ã‚¿ãƒ¼</span>
        </div>
      </div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³6: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="controlSection statusSection">
      <div id="status" class="statusText"></div>
      <div class="zoomInfo">Zoom: <span id="zoomLevel">-</span></div>
    </div>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="loadingOverlay" class="loadingOverlay">
    <div class="loadingContainer">
      <div class="loadingSpinner"></div>
      <div id="loadingText" class="loadingText">èª­ã¿è¾¼ã¿ä¸­...</div>
      <div id="loadingProgress" class="loadingProgress">
        <div id="loadingProgressBar" class="loadingProgressBar"></div>
      </div>
    </div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/proj4@2.8.0/dist/proj4.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  
  <!-- é †åº 1: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç®¡ç† & ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
  <script src="assets/loading-manager.js"></script>
  <script src="assets/utils.js"></script>
  
  <!-- é †åº 2: è¨­å®š -->
  <script src="assets/config.js"></script>
  
  <!-- é †åº 3: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  -->
  <script src="assets/dijkstra.js"></script>
  
  <!-- é †åº 4: æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
  <script src="assets/isochrone-service.js"></script>
  <script src="assets/ui-controller.js"></script>
  <script src="assets/map-layers.js"></script>
  <script src="assets/address-search.js"></script>
  
  <!-- é †åº 5: ãƒ¡ã‚¤ãƒ³åˆ¶å¾¡ -->
  <script src="assets/main.js"></script>
  <script>
    // æœ€çµ‚æ›´æ–°æ—¥ã‚’è¨­å®š
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const dateStr = `${year}å¹´${month}æœˆ${day}æ—¥`;
      
      // PCç‰ˆ
      document.getElementById('lastUpdateDate').textContent = dateStr;
      
      // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ
      const mobileUpdateEl = document.getElementById('mobileLastUpdate');
      if (mobileUpdateEl) {
        mobileUpdateEl.textContent = dateStr;
      }
    });
  </script>
</body>

</html>
