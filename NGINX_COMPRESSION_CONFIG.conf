# nginx 設定例 - gzip 圧縮設定
# このファイルを nginx.conf の http セクションに追加してください
#
# 使用方法:
# 1. /etc/nginx/nginx.conf を編集
# 2. http { ... } セクション内に以下を追加
# 3. sudo systemctl reload nginx で反映

# ============================================
# GZIP 圧縮設定（50～60% サイズ削減）
# ============================================
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;  # 圧縮レベル 1～9（6 が推奨）
gzip_types 
  text/plain 
  text/css 
  text/xml 
  text/javascript 
  application/json 
  application/javascript 
  application/xml+rss 
  application/x-javascript
  application/geo+json
  image/svg+xml;
gzip_min_length 1024;  # 1KB以上のファイルのみ圧縮
gzip_disable "msie6";  # IE6 互換性

# ============================================
# ブラウザキャッシング設定
# ============================================
# static な JSON/GeoJSON ファイル（7日間キャッシュ）
location ~* \.(json|geojson)$ {
  expires 7d;
  add_header Cache-Control "public, max-age=604800";
  add_header ETag '"v1"';  # バージョンを指定（更新時は v2 に変更）
}

# JavaScript/CSS（7日間キャッシュ）
location ~* \.(js|css)$ {
  expires 7d;
  add_header Cache-Control "public, max-age=604800";
}

# HTML（1時間キャッシュ）
location ~* \.html$ {
  expires 1h;
  add_header Cache-Control "public, max-age=3600";
}

# 画像（30日間キャッシュ）
location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
  expires 30d;
  add_header Cache-Control "public, max-age=2592000";
}

# ============================================
# セキュリティヘッダ
# ============================================
add_header X-Content-Type-Options "nosniff";
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
